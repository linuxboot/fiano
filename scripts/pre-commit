# Copyright 2018 the LinuxBoot Authors. All rights reserved
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

#!/bin/bash

set -e

echo "Running Pre-Commit"

FILES=`git diff --staged --name-only | grep '.*\.go' | cat`

if [ -z "$FILES" ];
then
	echo "No go files to check. Skipping."
	exit 0
fi

gofmt -w -s $FILES
golint -set_exit_status $FILES
go tool vet utk uefi uuid unicode fmap pkg/fmap integration visitors

# Check it builds

(cd utk && go build .)
(cd utk2 && go build .)

# Check tests

(cd visitors && go test)
(cd uefi && go test)
echo "Pre-Commit Passed"
